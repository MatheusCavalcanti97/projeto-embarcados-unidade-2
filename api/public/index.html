<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Controle da L√¢mpada</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        margin-top: 50px;
      }
      button {
        margin: 10px;
        padding: 10px 20px;
        font-size: 16px;
      }
      #status {
        margin-top: 20px;
        font-size: 18px;
      }
    </style>
  </head>
  <body>
    <h1>üí° Controle da L√¢mpada</h1>

    <div>
      <button onclick="setMode('manual')">Modo Manual</button>
      <button onclick="setMode('automatico')">Modo Autom√°tico</button>
    </div>

    <div id="manualControls" style="display: none">
      <button onclick="sendCommand('on')">Ligar</button>
      <button onclick="sendCommand('off')">Desligar</button>
    </div>

    <div id="status">Carregando status...</div>

    <script>
      async function setMode(modo) {
        await fetch("/modo", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ modo }),
        });
        updateStatus();
      }

      async function sendCommand(estado) {
        await fetch("/manual", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ estado }),
        });
      }

      async function updateStatus() {
        const res = await fetch("/status");
        const data = await res.json();
        document.getElementById(
          "status"
        ).innerText = `üîÑ Modo: ${data.modo} | üå°Ô∏è Lux: ${data.lux}`;

        document.getElementById("manualControls").style.display =
          data.modo === "manual" ? "block" : "none";
      }

      setInterval(updateStatus, 2000);
      updateStatus();
    </script>
  </body>
</html>
